# ะะตะณัะปััะพัะฝัะน ะพัััั ะฟะพ ััะตัะฐะผ

ะฃัะตะฑะฝัะน ะฟัะพะตะบั ะดะตะผะพะฝัััะธััะตั **ะฟะพะปะฝัะน ัะธะบะป** ะฟะพัััะพะตะฝะธั ะฒะธััะธะฝั ะธยะพััััะฐ ะดะปั ัะตะณัะปััะพัะฝะพะณะพ ะบะพะฝััะพะปั ะพััะฐัะบะพะฒ ะฟะพ ะฑะฐะฝะบะพะฒัะบะธะผ ััะตัะฐะผ.

## ๐ ะกัััะบัััะฐ ัะตะฟะพะทะธัะพัะธั

```
.
โโโ generate_json.py           # ะะตะฝะตัะฐัะพั JSONโัะฐะนะปะพะฒ
โโโ etl_load_accounts.py       # ETLโะทะฐะณััะทะบะฐ ะฒยPostgreSQL
โโโ ะกะบัะธะฟัยัะพะทะดะฐะฝะธัยัะฐะฑะปะธั.sql  # DDL: staging, reporting, ะฟัะตะดััะฐะฒะปะตะฝะธะตโฏaccounts_view
โโโ README.md                  # ะัยะทะดะตัั
```

## ๐๏ธ ะฅัะฐะฝะธะปะธัะต ะดะฐะฝะฝัั (PostgreSQLย15+)

| ะกัะตะผะฐ | ะะฑัะตะบั | ะะฐะทะฝะฐัะตะฝะธะต |
|-------|--------|------------|
| **staging** | `accounts_raw` | ะัะธัะผะฝะธะบ ยซะบะฐะบ ะตัััยป ะดะปั ะพะดะฝะพะน ัััะพัะฝะพะน ะฒัะณััะทะบะธ |
| **reporting** | `accounts` | ะะบััะฐะปัะฝะฐั ะฒะตััะธั ััััะฐ (dedupย+ยSCDโ1) |
| **reporting** | `accounts_view` *(VIEW)* | ะัะฑะพั ััััะพะฒ ัยะฑะฐะปะฐะฝัะพะผย>`500โฏ000` ะดะปั ะพััััะฝะพััะธ |

DDL ะฝะฐัะพะดะธััั ะฒย[`ะกะบัะธะฟั ัะพะทะดะฐะฝะธั ัะฐะฑะปะธั.sql`](./ะกะบัะธะฟั%20ัะพะทะดะฐะฝะธั%20ัะฐะฑะปะธั.sql).

## โ๏ธ ะะตะฝะตัะฐัะธั ะดะฐะฝะฝัั

```bash
# ัะพะทะดะฐัั ~260ยัะฐะฑะพัะธั JSONโัะฐะนะปะพะฒ ะทะฐ 2024ยะณะพะด
python generate_json.py
```

ะะฐะถะดัะน ัะฐะนะป ัะพะดะตัะถะธั 50ยะทะฐะฟะธัะตะน ัยะดะพะฟัััะธะผัะผ 10โฏ% ะดัะฑะปะธัะพะฒะฐะฝะธะตะผ.  
ะะพะปะต `opened_at` ะฒะฐััะธััะตััั ะฒยะดะธะฐะฟะฐะทะพะฝะต ยฑ5ยะปะตั ะพั ัะตะบััะตะน ะดะฐัั ัะฐะนะปะฐ.

## ๐ ะะฐะณััะทะบะฐ (ETL)

```bash
# 1ยโ ะฟัะธะผะตะฝัะตะผ DDL
psql -f "ะกะบัะธะฟั ัะพะทะดะฐะฝะธั ัะฐะฑะปะธั.sql"

# 2ยโ ะทะฐะณััะถะฐะตะผ ะฒัะต JSONโั
python etl_load_accounts.py
```

ะญัะฐะฟั:
1. **Staging.** `INSERT`ยะธััะพะดะฝัั ัััะพะบ ะฒย`staging.accounts_raw`.
2. **Upsert.** `INSERTยโฆ ON CONFLICT` ะฒย`reporting.accounts` (ะพััะฐะฒะปัะตะผ ะฟะพัะปะตะดะฝัั ะฒะตััะธั ััััะฐ).
3. **ะะธััะธะฝะฐ.** ะัะตะดััะฐะฒะปะตะฝะธะต `accounts_view` ะฟัะฑะปะธะบัะตั ัะพะปัะบะพ ััะตัะฐ ัยะฑะฐะปะฐะฝัะพะผย>`500โฏ000`.

ะัะพะฒะตัะบะฐ ะฒัะฑะพัะบะธ ะฝะฐ 50ยะทะฐะฟะธััั:

```sql
SELECT *
FROM reporting.accounts_view
LIMIT 50;
```

## ๐ ะัััั ะฒยMetabase

ะ Metabase ัะพะทะดะฐะฝ **ะฒะพะฟัะพัยยซAccountsย>โฏ500โฏk byยDateยป** ะฝะฐยะฑะฐะทะต ะฟัะตะดััะฐะฒะปะตะฝะธั `accounts_view`:

* ะขะธะฟ: _simple table_  
* ะคะธะปััั: ะฟะพะปะต `load_date` (ะดะธะฐะฟะฐะทะพะฝ)  
* ะกะพััะธัะพะฒะบะฐยโ ะฟะพย`balance`ย(ัะฑัะฒ.)

ะะพะบะฐะปัะฝัะน ะทะฐะฟััะบ Metabase (ะฟะพััย`3000`):

```bash
docker run -d --name metabase -p 3000:3000 metabase/metabase
```

ะะพัะปะต ะฟะตัะฒะพะณะพ ะทะฐะฟััะบะฐ ะฟะพะดะบะปััะธัะต PostgreSQL ะบะฐะบ ะธััะพัะฝะธะบ ะดะฐะฝะฝัั ะธยะฒัะฑะตัะธัะต ะฒััะตัะบะฐะทะฐะฝะฝัะน ะฒะพะฟัะพั ะดะปั ะดะฐัะฑะพัะดะฐ.
